# 📸 照片档案选择器功能

## 🎯 功能概述

为富文本编辑器增加了从照片档案中选择已上传图片的功能，用户现在可以方便地复用之前上传的照片。

## 🚀 主要功能

### 1. 照片选择器界面
- **全屏模态框**：专业的照片选择界面
- **搜索功能**：按名称、描述、标签、地点、人物搜索
- **范围过滤**：可选择全部照片、当前项目或当前章节的照片
- **双视图模式**：网格视图和列表视图
- **智能加载**：只显示有效的照片（过滤blob URL）

### 2. 编辑器集成
- **新增按钮**：富文本编辑器工具栏新增"🖼️ 选择照片"按钮
- **无缝插入**：选择的照片直接插入到光标位置
- **自动关联**：插入的图片会自动关联到当前项目和章节

### 3. 智能范围选择
- **全部照片**：显示用户所有已上传的照片
- **项目照片**：只显示当前项目相关的照片
- **章节照片**：只显示当前章节的照片

## 🔧 技术实现

### 1. 核心组件
- `PhotoPickerModal`: 照片选择器主组件
- `SmartImage`: 智能图片显示组件（自动处理URL失效）
- `EditorWithUpload`: 更新后的编辑器组件

### 2. 数据流程
```typescript
用户点击"选择照片" 
→ 打开PhotoPickerModal 
→ 根据范围加载照片数据 
→ 用户搜索/筛选照片 
→ 点击选择照片 
→ 调用handlePhotoSelected 
→ 通过editorRef插入图片 
→ 关闭模态框
```

### 3. 数据库查询
- `getUserPhotos()`: 获取用户全部照片
- `getProjectPhotos()`: 获取项目照片
- `getChapterPhotos()`: 获取章节照片

## 📋 使用指南

### 在编辑器中使用
1. **打开编辑器**：进入任意项目的编辑页面
2. **点击选择照片**：在富文本编辑器工具栏点击"🖼️ 选择照片"按钮
3. **选择范围**：
   - 全部照片：显示您所有已上传的照片
   - 本项目照片：只显示当前项目的照片
   - 本章节照片：只显示当前章节的照片
4. **搜索照片**：使用搜索框快速找到需要的照片
5. **切换视图**：可选择网格视图或列表视图
6. **选择插入**：点击照片即可插入到编辑器中

### 搜索功能
支持按以下字段搜索：
- 📝 照片名称
- 📄 照片描述
- 📍 拍摄地点
- 🏷️ 标签
- 👤 相关人物

## 🎨 界面特性

### 照片选择器
- **响应式设计**：适配不同屏幕尺寸
- **网格视图**：以缩略图网格显示照片
- **列表视图**：显示详细信息的列表
- **悬停效果**：鼠标悬停显示选择提示
- **加载状态**：显示加载动画
- **空状态**：友好的空状态提示

### 编辑器集成
- **工具栏按钮**：清晰的按钮标识
- **状态切换**：按钮文字随状态变化
- **快速插入**：选择后立即插入图片

## 🔄 工作流程

### 典型使用场景
1. **写作时复用照片**：
   - 在写作过程中需要插入之前上传的照片
   - 点击"选择照片"打开选择器
   - 快速找到并插入相关照片

2. **项目内照片复用**：
   - 在不同章节中使用相同的照片
   - 选择"本项目照片"范围
   - 插入项目相关的照片

3. **快速查找照片**：
   - 使用搜索功能快速定位照片
   - 按标签、人物、地点等搜索
   - 提高写作效率

## 🛠️ 开发者说明

### 组件结构
```
EditorWithUpload
├── PhotoUploadEnhanced (上传新照片)
├── PhotoPickerModal (选择已有照片)
├── VoiceRecorder
├── OCRUpload
└── AIWritingAssistant
```

### 状态管理
- `showPhotoPicker`: 控制照片选择器显示
- `selectedScope`: 照片范围选择
- `searchQuery`: 搜索查询
- `viewMode`: 视图模式切换

### API调用
- 动态导入数据库服务避免SSR问题
- 智能加载不同范围的照片数据
- 过滤无效的blob URL照片

## 🚀 未来扩展

可以考虑的功能扩展：
- 📱 批量选择照片
- 🔄 照片拖拽排序
- 🖼️ 照片预览放大
- 📊 按上传时间分组
- 🎨 照片样式设置
- 📝 插入时添加说明文字

## 🎉 使用效果

现在用户可以：
- ✅ 在编辑器中方便地选择已上传的照片
- ✅ 通过搜索快速找到需要的照片
- ✅ 按项目/章节范围筛选照片
- ✅ 享受流畅的照片插入体验
- ✅ 提高写作效率和照片复用率

**立即体验**：打开编辑器，点击"🖼️ 选择照片"按钮开始使用！